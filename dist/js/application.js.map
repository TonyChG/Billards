{"version":3,"sources":["../../js/application.js"],"names":["App","cvs","height","width","render","getContext","balls","BallSet","init","interval","cfg","FPS","then","Date","now","addEventListener","getMousePos","e","handleMouseDown","evt","rect","getBoundingClientRect","mx","clientX","left","my","clientY","top","handleMouseMove","n","len","length","list","mouseOn","mouseIsOn","cx","cy","i","ball","getSelectedBall","selected","mouseNotOnAnyBall","vx","x","vy","y","unSelectBalls","updateMouseOn","undefined","angle","Math","atan2","PI","sin","cos","RADIUS","drawCircle","isOnBall","isInScreen","drawLine","getPosOfFirstObj","delta","requestAnimationFrame","update","bind","fillStyle","fillRect","drawTable","drawBalls","computeCollision","drawPath"],"mappings":"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","file":"application.js","sourcesContent":["/**\n * Created by antoine on 28/01/17.\n */\n\nclass App {\n\n    constructor(cvs) {\n        this.cvs    = cvs;\n        this.height = cvs.height;\n        this.width  = cvs.width;\n        this.render = cvs.getContext(\"2d\");\n        this.balls  = new BallSet(this.width, this.height, this.render).init();\n        this.interval = 1000 / cfg.FPS;\n        this.then = Date.now();\n    }\n\n    init () {\n        this.cvs.addEventListener(\"mousemove\", e => this.getMousePos(e));\n        this.cvs.addEventListener(\"mousedown\", e => this.handleMouseDown(e));\n    }\n\n    getMousePos(evt) {\n        let rect = this.cvs.getBoundingClientRect();\n        this.mx = evt.clientX - rect.left;\n        this.my = evt.clientY - rect.top;\n        this.handleMouseMove();\n    }\n\n    handleMouseMove () {\n        for (let n = 0, len = this.balls.length; n < len; n++) {\n            this.balls.list[n].mouseOn = !!this.balls.list[n].mouseIsOn(this.mx, this.my);\n        }\n    }\n\n    handleMouseDown (evt) {\n        let rect = this.cvs.getBoundingClientRect();\n        let cx = evt.clientX - rect.left;\n        let cy = evt.clientY - rect.top;\n\n        for (let i = 0, len = this.balls.list.length; i < len; i++) {\n            let ball = this.balls.list[i];\n            if (this.balls.getSelectedBall() && ball.selected) {\n                if (this.balls.mouseNotOnAnyBall()) {\n                    ball.vx += (ball.x - cx) / 10;\n                    ball.vy += (ball.y - cy) / 10;\n                }\n            }\n        }\n        this.balls.unSelectBalls();\n        this.balls.updateMouseOn();\n    }\n\n    getPosOfFirstObj () {\n        if (this.mx != undefined && this.my !== undefined) {\n            let ball = this.balls.getSelectedBall(),\n                angle = Math.atan2(ball.x - this.mx, ball.y - this.my) - Math.PI / 2,\n                sin = Math.sin(-angle), cos = Math.cos(angle),\n                x = ball.x + ((cfg.RADIUS + 10) * cos), y = ball.y + ((cfg.RADIUS + 10) * sin);\n\n            drawCircle(this.render, x, y, 3, \"red\");\n            while (!this.balls.isOnBall(x, y) && this.balls.isInScreen(x, y)) {\n                x += cos;\n                y += sin;\n            }\n            drawLine(this.render, ball.x, ball.y, x, y, \"white\");\n        }\n    }\n\n    drawPath () {\n        let ball = this.balls.getSelectedBall();\n        if (ball) drawLine(this.render, ball.x, ball.y, this.mx, this.my, \"white\");\n        this.getPosOfFirstObj();\n    }\n\n    drawTable () {\n        drawCircle(this.render, cfg.RADIUS, cfg.RADIUS, cfg.RADIUS, \"black\");\n        drawCircle(this.render, this.width-cfg.RADIUS, cfg.RADIUS, cfg.RADIUS, \"black\");\n        drawCircle(this.render, this.width/2, cfg.RADIUS, cfg.RADIUS, \"black\");\n        drawCircle(this.render, cfg.RADIUS, this.height-cfg.RADIUS, cfg.RADIUS, \"black\");\n        drawCircle(this.render, this.width/2, this.height-cfg.RADIUS, cfg.RADIUS, \"black\");\n        drawCircle(this.render, this.width-cfg.RADIUS, this.height-cfg.RADIUS, cfg.RADIUS, \"black\");\n    }\n\n    update () {\n        let now = Date.now(),\n            delta = now - this.then;\n\n        requestAnimationFrame(this.update.bind(this));\n\n        if (delta > this.interval) {\n\n            this.then = now - (delta % this.interval);\n\n            this.render.fillStyle = \"#347c46\";\n            this.render.fillRect(0, 0, this.width, this.height);\n\n            this.drawTable();\n\n            this.balls.drawBalls();\n            this.balls.computeCollision();\n\n            this.drawPath();\n\n        }\n    }\n}"]}